<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Amistad HD Celular</title>
    <style>
        /* Reset total para evitar márgenes raros en móvil */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #000; overflow: hidden; font-family: 'Arial Black', sans-serif; touch-action: none; height: 100vh; width: 100vw; display: flex; justify-content: center; align-items: center; }
        canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        
        #btn-inicio {
            position: relative; z-index: 100; padding: 18px 35px; font-size: 1rem;
            background: transparent; color: #fff; border: 2px solid #fff; border-radius: 50px;
            cursor: pointer; letter-spacing: 2px; text-transform: uppercase;
        }

        #instrucciones {
            position: fixed; bottom: 10%; width: 100%; text-align: center;
            color: rgba(255,255,255,0.4); font-size: 0.75rem; letter-spacing: 1px;
            z-index: 10; pointer-events: none; display: none;
        }
    </style>
</head>
<body>

    <button id="btn-inicio" onclick="comenzar()">Abrir Amistad ✨</button>
    <div id="instrucciones">TOCA LA PANTALLA PARA OTRA FRASE</div>

    <audio id="musica" loop preload="auto">
        <source src="musica.mp3" type="audio/mpeg">
    </audio>

    <canvas id="canvas"></canvas>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const audio = document.getElementById('musica');
        
        const frases = [
            "Eres la mejor amiga", "Gracias por tantas risas", "Nuestra amistad es un tesoro",
            "Eres súper leal", "Gracias por escucharme", "Haces todo divertido",
            "Suerte de conocerte", "Eres una crack", "Nuestras locuras mandan",
            "Mejor confidente", "Admiro cómo eres", "Por más años juntos",
            "Me haces el día", "Me encanta nuestra vibra", "Pura buena onda",
            "Gracias por los consejos", "De mi equipo siempre", "Nadie me entiende como tú",
            "Persona valiosa", "Amo nuestras anécdotas", "Apoyo constante",
            "Buen equipo hacemos", "Eres auténtica", "Gracias por estar",
            "Amistad sin precio", "Súper talentosa", "Amo tu energía",
            "Persona más divertida", "Gracias por ser tú", "Hermana elegida",
            "Palabra justa siempre", "Por mil aventuras", "Siempre sumas",
            "Amistad de hierro", "Buenos recuerdos", "Clave en mi vida",
            "Gracias por tu sinceridad", "Persona favorita", "Todo es más fácil",
            "Gran amiga", "Aprecio tu lealtad", "Eres pura luz",
            "Cero juicios contigo", "Mejor para los planes", "Conexión única",
            "Eres un ejemplo", "Amo tu humor", "Amistad eterna",
            "Eres súper real", "Apoyo total", "Pláticas infinitas",
            "Súper inteligente", "Qué bien la pasamos", "Mi mejor aliada",
            "Aguantas mis locuras", "Eres brillante", "Amo tu honestidad",
            "De lo mejor que tengo", "Indestructible", "Muy creativa",
            "Me motivas siempre", "Eres de palabra", "Qué risas nos damos",
            "Cuento contigo", "Vales oro puro", "Gracias por tu tiempo",
            "La más ocurrente", "Incondicional", "Mente abierta",
            "Sabes escuchar", "Eres increíble", "Eres mi guía",
            "Mi mejor socia", "Historias de leyenda", "Buen corazón",
            "Fortuna tenerte cerca", "Gran apoyo moral", "Eres muy noble",
            "Eres valiente", "Amo nuestra confianza", "Mejores recuerdos",
            "A prueba de todo", "Súper capaz", "Mucha paciencia",
            "La mejor para charlar", "Buena vibra siempre", "Alguien especial",
            "Siempre estás ahí", "Mejor partner", "Gracias por ser amiga",
            "Amigas por siempre", "Fuera de serie", "¡Eres la mejor!"
        ];

        let particles = [];
        let indexFrase = 0;
        let stage = 0; // 0: Lluvia, 1: Frase
        const dpr = window.devicePixelRatio || 2;

        function comenzar() {
            document.getElementById('btn-inicio').style.display = 'none';
            document.getElementById('instrucciones').style.display = 'block';
            audio.play().catch(() => console.log("Audio bloqueado"));
            stage = 0;
            init();
            animate();
        }

        function setSize() {
            canvas.width = window.innerWidth * dpr;
            canvas.height = window.innerHeight * dpr;
            ctx.scale(dpr, dpr);
        }

        class Particle {
            constructor(tx, ty) {
                this.tx = tx; this.ty = ty;
                this.x = Math.random() * window.innerWidth;
                this.y = Math.random() * -window.innerHeight;
                this.vx = (Math.random() - 0.5) * 2;
                this.vy = Math.random() * 2 + 2;
                this.active = true;
                this.size = Math.random() * 1.2 + 0.8;
            }

            update() {
                if (stage === 0) {
                    this.y += this.vy;
                    if (this.y > window.innerHeight) this.y = -20;
                } else if (this.active) {
                    this.x += (this.tx - this.x) * 0.1;
                    this.y += (this.ty - this.y) * 0.1;
                } else {
                    this.x += this.vx; this.y += this.vy;
                    this.vx *= 0.95; this.vy *= 0.95;
                }
            }

            draw() {
                ctx.fillStyle = "#ffffff";
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function obtenerPuntos(texto) {
            const tCanvas = document.createElement('canvas');
            const tCtx = tCanvas.getContext('2d');
            tCanvas.width = window.innerWidth;
            tCanvas.height = window.innerHeight;
            
            const fontSize = window.innerWidth < 600 ? 30 : 50;
            tCtx.font = `900 ${fontSize}px sans-serif`;
            tCtx.textAlign = 'center';
            tCtx.textBaseline = 'middle';
            
            const palabras = texto.split(" ");
            let lineas = [], lineaActual = "";
            palabras.forEach(p => {
                if((lineaActual + p).length > (window.innerWidth < 600 ? 15 : 30)) {
                    lineas.push(lineaActual); lineaActual = p + " ";
                } else { lineaActual += p + " "; }
            });
            lineas.push(lineaActual);

            lineas.forEach((l, i) => {
                const yPos = (window.innerHeight / 2) + (i * fontSize * 1.2) - ((lineas.length - 1) * fontSize * 0.6);
                tCtx.fillText(l, window.innerWidth / 2, yPos);
            });

            const data = tCtx.getImageData(0, 0, tCanvas.width, tCanvas.height).data;
            let pts = [];
            for (let y = 0; y < tCanvas.height; y += 3) {
                for (let x = 0; x < tCanvas.width; x += 3) {
                    if (data[(y * tCanvas.width + x) * 4 + 3] > 128) pts.push({x, y});
                }
            }
            return pts;
        }

        function init() {
            setSize();
            const pts = obtenerPuntos(frases[0]);
            particles = pts.map(p => new Particle(p.x, p.y));
        }

        function cambiarFrase() {
            if (stage === 0) {
                stage = 1;
                return;
            }
            
            particles.forEach(p => {
                p.active = false;
                p.vx = (Math.random() - 0.5) * 30;
                p.vy = (Math.random() - 0.5) * 30;
            });

            indexFrase = (indexFrase + 1) % frases.length;
            const pts = obtenerPuntos(frases[indexFrase]);
            
            setTimeout(() => {
                particles = pts.map(p => new Particle(p.x, p.y));
            }, 100);
        }

        function animate() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
            ctx.fillRect(0, 0, window.innerWidth, window.innerHeight);
            particles.forEach(p => { p.update(); p.draw(); });
            requestAnimationFrame(animate);
        }

        window.addEventListener('mousedown', (e) => { if(e.target.id !== 'btn-inicio') cambiarFrase(); });
        window.addEventListener('touchstart', (e) => { if(e.target.id !== 'btn-inicio') cambiarFrase(); });
        window.addEventListener('resize', setSize);
    </script>
</body>
</html>
